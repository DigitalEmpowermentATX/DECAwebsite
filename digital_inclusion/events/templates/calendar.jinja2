{% extends "base.jinja2" %}
{% load staticfiles %}
{% block imports %}
    <script src="{% static 'moment.min.js' %}"></script>
    <script src="{% static 'fullcalendar.js' %}"></script>
{% endblock imports %}
{% block style %}
    <link rel="stylesheet" href="{% static 'fullcalendar.css' %}">
    <style>
        body {
            margin: 40px 10px;
            padding: 0;
            font-family: "Lucida Grande", Helvetica, Arial, Verdana, sans-serif;
            font-size: 14px;
        }

        #calendar {
            margin-top: 40px !important;
            max-width: 900px;
            margin: 0 auto;
        }
    #add_event_btn{
        {#float:right;#}
        clear: both;
        display: block;
    }
    </style>
{% endblock style %}
{% load widget_tweaks %}
{% load static %}
{% block content %}
    {% if user.is_authenticated %}
        <a href="{% url 'events:add_event' %}" class="btn btn-info" role="button" id="add_event_btn">Add Event</a>
    {% endif %}
    <div id='calendar'></div>

{% endblock content %}

{% block scripts %}
    <script>
        var events = [
            {% for event in events %}
                {
                    title: "{{ event.name}}",
                    start: "{{ event.start_time|date:'Y-m-d H:m:s'}}",
                    end: "{{ event.end_time |date:'Y-m-d H:m:s'}}",
                    url : "{{ event.url }}",
                },
            {% endfor %}
        ]
        $(document).ready(function () {
            var calendar = $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay,listWeek'
                },
                defaultDate: new Date().toISOString().split('T')[0],
                navLinks: true, // can click day/week names to navigate views
                editable: false,
                eventLimit: true, // allow "more" link when too many events
                events: events,
                eventClick: function(calEvent, jsEvent, view) {

                    {#alert('Event: ' + calEvent.title);#}
                    {#alert('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);#}
                    {#alert('View: ' + view.name);#}

                    // change the border color just for fun
                    {#$(this).css('border-color', 'red');#}
                    jsEvent.preventDefault()
                    console.log(calEvent)
                    if (typeof calEvent.url != 'undefined' && calEvent.url != "None"){
                        window.open(calEvent.url, "_blank")
                    }
                }
            });

            calendar.on('dayClick', function(date, jsEvent, view) {
                console.log('clicked on ' + date.format(), jsEvent, view);
            });

        });
    </script>
{% endblock scripts %}